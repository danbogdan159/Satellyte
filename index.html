<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.81/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.81/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/satellite.js/4.0.0/satellite.min.js"></script>
  <link href="style.css" rel="stylesheet">
</head>
<body>
  <div id="cesiumContainer"></div>
  <script>
    async function getData(){
      try{
        const response = await fetch('https://tle.ivanstanojevic.me/api/tle')
        if(!response.ok){
          throw new Error('Could not retrieve data');
        }
        const data = await response.json();
        for(let i = 0; i < data.member.length; i++){
          const line1 = data.member[i].line1;
          const line2 = data.member[i].line2;
          console.log(`TLE Lines: ${line1}, ${line2}`);
          const satrec = satellite.twoline2satrec(line1, line2);
          const positionAndVelocity = satellite.propagate(satrec, new Date());
          if(positionAndVelocity.position) {
            const gmst = satellite.gstime(new Date());
            const position = satellite.eciToGeodetic(positionAndVelocity.position, gmst);
          
            const satellitePoint = viewer.entities.add({
              position: Cesium.Cartesian3.fromRadians(
                position.longitude, position.latitude, position.height * 1000
              ),
              point: { pixelSize: 10, color: Cesium.Color.RED }
            
            });
          };
        };
      }
      catch(error){
        console.error(error);
      }
    };
    const viewer = new Cesium.Viewer('cesiumContainer', {
      imageryProvider: new Cesium.TileMapServiceImageryProvider({
        url: Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII"),
      }),
      baseLayerPicker: false, geocoder: false, homeButton: false, infoBox: false,
      navigationHelpButton: false, sceneModePicker: false
    });
    viewer.scene.globe.enableLighting = true;
    getData();
  </script>
</body>
</html>